@model InmobiliariaConstante.Models.Contrato

@{
    ViewData["Title"] = "Crear Contrato";
    var Garantes = (IList<Garante>)ViewBag.Garantes;
    var Inmuebles = (IList<Inmueble>)ViewBag.Inmuebles;
    var Inquilinos = (IList<Inquilino>)ViewBag.Inquilinos;
}

<h1>Crear nuevo Contrato</h1>

<h4>Contrato</h4>
<hr />
<div class="row">
    <div class="col-md-4">
        <form asp-action="Create">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="form-group">
                <label class="control-label">Inquilino: </label>
                <select class="form-control" name="IdInquilino">
                    @foreach (Inquilino val in Inquilinos)
                    {
                        @:<option selected value="@val.IdInquilino">@(val.Nombre +" "+ val.Apellido)</option>
                    }
                </select>
                <span asp-validation-for="IdInquilino" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="FechaDesde" class="control-label"></label>
                <input asp-for="FechaDesde" id="selectDesde" class="form-control" type="date" />
                <span asp-validation-for="FechaDesde" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="FechaHasta" class="control-label"></label>
                <input asp-for="FechaHasta" id="selectHasta" class="form-control" type="date" />
                <span asp-validation-for="FechaHasta" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label class="control-label">Inmueble: </label>
                <select class="form-control" id="selectInmueble" name="IdInmueble">
                    <option selected value="Seleccione un Inmueble">-- Seleccione un Inmueble --</option>
                </select>
                <span asp-validation-for="IdInmueble" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Cuotas" class="control-label"></label>
                <input asp-for="Cuotas" class="form-control" />
                <span asp-validation-for="Cuotas" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label class="control-label">Garante: </label>
                <select class="form-control" name="IdGarante">
                    @foreach (Garante val in Garantes)
                    {
                        @:<option selected value="@val.Id">@(val.Nombre +" "+ val.Apellido)</option>
                    }
                </select>
                <span asp-validation-for="IdGarante" class="text-danger"></span>
            </div>
            <div class="form-group">
                <input type="submit" value="Crear" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>

<div>
    <a asp-action="Index">Volver a la lista</a>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
<script type="text/javascript">
    var selectDesde = document.getElementById('selectDesde');
    var selectHasta = document.getElementById('selectHasta');
    var selectInmueble = document.getElementById('selectInmueble');
    function buscarInmuebles() {
        let myObjectJSON = {};
        var FechaDesde = selectDesde.value;
        var FechaHasta = selectHasta.value;
        url = `@Url.Action("Buscar", "Contrato", new { fechaDesde = "fechaDesde", fechaHasta = "fechaHasta" })`;
        url = url.replace("fechaDesde", FechaDesde)
            .replace("fechaHasta", FechaHasta);
        return $.ajax({
            url: url,
        }).done(res => {
            myObjectJSON = res;
            if (!myObjectJSON.datos) {
                return;
            }
            selectInmueble.innerHTML = "";
            for (let x of myObjectJSON.datos) {
                let option = document.createElement("option");
                option.value = x.id;
                option.text = x.direccion+" "+x.precio;
                selectInmueble.add(option);
            }
        }).fail(res => {
            console.log("Error: ", res);
        });
    }


    selectHasta.addEventListener('change', () => {
        buscarInmuebles();
    });

</script>
